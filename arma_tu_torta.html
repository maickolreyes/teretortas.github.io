<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teretortas y Más · Arma tu torta</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(2, minmax(0,1fr));gap:12px}
    @media (max-width:780px){.grid{grid-template-columns:1fr}}
    section.card{background:#fff;border:1px solid var(--border,#e5e7eb);border-radius:14px;padding:16px;margin:12px 0}
    h1{font-size:28px;margin:6px 0 2px}
    h2{font-size:18px;margin:0 0 12px}
    label{font-weight:700;display:block;margin-bottom:6px}
    select, input[type="number"], input[type="text"], textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:10px}
    .note{color:#6b7280;font-size:12px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .pill{padding:4px 10px;border-radius:999px;background:#f3f4f6;font-size:12px}
    .tot{font-size:22px;font-weight:800}
    .btn{background:#111827;color:#fff;border:none;padding:12px 16px;border-radius:10px;cursor:pointer}
    .btn.secondary{background:#f3f4f6;color:#111827}
    .badges{display:flex;gap:8px;flex-wrap:wrap}
    footer .links a{margin-left:10px}
  </style>
</head>
<body>
  <header>
    <div class="container brand">
      <div class="logo"><img src="teretortas_circle.png" alt="Teretortas y Más"/></div>
      <div>
        <h1>Arma tu torta</h1>
        <nav class="note">
          <a href="index.html">Inicio</a>
          <a href="arma_tu_torta.html" class="active"><b>Arma tu torta</b></a>
          <a href="agenda.html">Agenda</a>
          <a href="inventario.html">Inventario</a>
        </nav>
        <div class="note">Configura tamaño, sabor, <b>dos rellenos</b> (opcional), cobertura y extras. Precios demo.</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- ============ 1) TAMAÑO, MARCO Y SABOR (REEMPLAZO) ============ -->
<section id="step1" class="card" style="margin-top:8px">
  <h2>1) Tamaño, marco y sabor</h2>

  <div class="note" style="margin:-6px 0 12px">
    Selecciona el tamaño (porciones/diámetro/capas), el <b>marco</b> (masa/base: sin azúcar, sin gluten, integral, etc.) y el sabor del bizcocho.
  </div>

  <div class="grid" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px">
    <!-- Tamaño -->
    <div>
      <label for="size">Tamaño</label>
      <select id="size" name="size">
        <option value="T12" data-porciones="12" data-diametro="18 cm" data-capas="2">12 porciones · Ø18 cm · 2 capas</option>
        <option value="T16" data-porciones="16" data-diametro="22 cm" data-capas="2">16 porciones · Ø22 cm · 2 capas</option>
        <option value="T20" data-porciones="20" data-diametro="24 cm" data-capas="3">20 porciones · Ø24 cm · 3 capas</option>
        <option value="T24" data-porciones="24" data-diametro="26 cm" data-capas="3">24 porciones · Ø26 cm · 3 capas</option>
        <option value="T30" data-porciones="30" data-diametro="30 cm" data-capas="3">30 porciones · Ø30 cm · 3 capas</option>
      </select>
      <p class="note" id="sizeMeta" style="margin:.35rem 0 0"></p>
    </div>

    <!-- Marco / Base dietaria -->
    <div>
      <label for="base">Marco (masa/base)</label>
      <select id="base" name="base">
        <option value="TRD" data-delta="0">Tradicional</option>
        <option value="SAZ" data-delta="1500">Sin azúcar (+$1.500)</option>
        <option value="SGL" data-delta="2000">Sin gluten (+$2.000)</option>
        <option value="INT" data-delta="1000">Integral (+$1.000)</option>
        <option value="ISG" data-delta="2500">Integral sin gluten (+$2.500)</option>
        <option value="VEG" data-delta="1500">Vegano (+$1.500)</option>
        <option value="VGS" data-delta="3000">Vegano sin gluten (+$3.000)</option>
      </select>
      <p class="note" style="margin:.35rem 0 0">El <b>marco</b> define la masa/base y restricciones dietarias.</p>
    </div>

    <!-- Sabor bizcocho -->
    <div>
      <label for="flavor">Sabor del bizcocho</label>
      <select id="flavor" name="flavor">
        <option value="VAN" data-delta="0">Vainilla</option>
        <option value="CHO" data-delta="1500">Chocolate (+$1.500)</option>
        <option value="RED" data-delta="2500">Red Velvet (+$2.500)</option>
        <option value="ZAN" data-delta="1500">Zanahoria (+$1.500)</option>
        <option value="LIM" data-delta="1000">Limón (+$1.000)</option>
      </select>
      <p class="note" style="margin:.35rem 0 0">Este ajuste se suma al precio del tamaño y del marco.</p>
    </div>
  </div>

  <!-- Resumen dinámico -->
  <div class="card" style="margin-top:14px;background:#fcfcfd">
    <div style="display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:space-between">
      <div>
        <div class="note">SKU preliminar</div>
        <div id="skuPreview" class="mono" style="font-weight:700">–</div>
      </div>
      <div>
        <div class="note">Precio base estimado</div>
        <div id="pricePreview" style="font-size:1.25rem;font-weight:800">$0</div>
      </div>
    </div>
  </div>
</section>

    <!-- ============ 2) RELLENOS Y COBERTURA ============ -->
<section id="step2" class="card" style="margin-top:16px">
  <h2>2) Rellenos y coberturas</h2>
  <p class="note" style="margin:-6px 0 12px">
    Selecciona hasta <b>dos rellenos</b> y una <b>cobertura</b>. Mostramos opciones compatibles con tu marco del paso 1.
  </p>

  <div class="grid" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px">
    <!-- Relleno 1 -->
    <div>
      <label for="fill1">Relleno 1</label>
      <select id="fill1" name="fill1">
        <!-- opciones se cargan por JS -->
      </select>
      <p id="fill1Meta" class="note" style="margin:.35rem 0 0"></p>
    </div>

    <!-- Relleno 2 (opcional) -->
    <div>
      <label for="fill2">Relleno 2 (opcional)</label>
      <select id="fill2" name="fill2">
        <option value="">— Sin segundo relleno —</option>
      </select>
      <p id="fill2Meta" class="note" style="margin:.35rem 0 0"></p>
    </div>

    <!-- Cobertura -->
    <div>
      <label for="cover">Cobertura</label>
      <select id="cover" name="cover">
        <!-- opciones se cargan por JS -->
      </select>
      <p id="coverMeta" class="note" style="margin:.35rem 0 0"></p>
    </div>
  </div>

  <!-- Resumen -->
  <div class="card" style="margin-top:14px;background:#fcfcfd">
    <div style="display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:space-between">
      <div>
        <div class="note">SKU (con rellenos y cobertura)</div>
        <div id="skuStep2" class="mono" style="font-weight:700">–</div>
      </div>
      <div>
        <div class="note">Total estimado (acum.)</div>
        <div id="priceStep2" style="font-size:1.25rem;font-weight:800">$0</div>
      </div>
    </div>
  </div>
</section>

    <!-- 3) Extras -->
    <section class="card">
      <h2>3) Extras</h2>
      <div class="grid">
        <label><input type="checkbox" class="extra" data-name="Velas" data-price="800"> Velas</label>
        <label><input type="checkbox" class="extra" data-name="Toppers" data-price="2500"> Toppers</label>
        <label><input type="checkbox" class="extra" data-name="Mini galletas" data-price="3000"> Mini galletas</label>
        <label><input type="checkbox" class="extra" data-name="Mensaje en chocolate" data-price="1200"> Mensaje en chocolate</label>
      </div>
      <p class="note">Los extras se agregan al total y aparecen como etiquetas.</p>
    </section>

    <!-- 4) Notas -->
    <section class="card">
      <h2>4) Notas del pedido</h2>
      <textarea id="notas" rows="3" placeholder="Texto de mensaje, colores, indicaciones…"></textarea>
    </section>

    <!-- Resumen -->
    <section class="card">
      <h2>Resumen</h2>
      <div id="sku" class="note mono"></div>
      <ul id="summary" class="note"></ul>
      <div class="row" style="justify-content:space-between;margin-top:8px">
        <div class="badges" id="badges"></div>
        <div class="tot" id="total">$0</div>
      </div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="btnAdd">Añadir al carrito (demo)</button>
        <button class="btn secondary" id="btnNext">Continuar</button>
      </div>
    </section>
  </main>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
      <span>© Teretortas y Más · Demo</span>
      <span class="links">
        <a href="https://wa.me/56911111111" target="_blank" rel="noopener">WhatsApp +56 9 1111 1111</a>
        <a href="https://instagram.com/teretortasymas" target="_blank" rel="noopener">Instagram Teretortas y Más</a>
        <a href="https://facebook.com/teretortasymas" target="_blank" rel="noopener">Facebook Teretortas y Más</a>
      </span>
    </div>
  </footer>

   <script>
/* ====== Lógica básica del paso 1 (con MARCO) ====== */
(function(){
  // Precios base por tamaño (CLP)
  const SIZE_BASE = { T12:15990, T16:18990, T20:22990, T24:25990, T30:31990 };

  const $size     = document.getElementById('size');
  const $base     = document.getElementById('base');
  const $flavor   = document.getElementById('flavor');
  const $sizeMeta = document.getElementById('sizeMeta');
  const $price    = document.getElementById('pricePreview');
  const $sku      = document.getElementById('skuPreview');

  function money(n){ return n.toLocaleString('es-CL',{style:'currency',currency:'CLP',maximumFractionDigits:0}); }

  function updateMeta(){
    const opt = $size.selectedOptions[0];
    $sizeMeta.textContent = `${opt.dataset.porciones} porciones · ${opt.dataset.diametro} · ${opt.dataset.capas} capas`;
  }

  function updateSummary(){
    const sizeCode   = $size.value;
    const baseOpt    = $base.selectedOptions[0];
    const flavorOpt  = $flavor.selectedOptions[0];

    const baseDelta   = Number(baseOpt.dataset.delta || 0);
    const flavorDelta = Number(flavorOpt.dataset.delta || 0);

    const basePrice = SIZE_BASE[sizeCode] || 0;
    const total     = basePrice + baseDelta + flavorDelta;

    $price.textContent = money(total);

    // SKU: Txx-BASE-FLV
    const sku = `${sizeCode}-${baseOpt.value}-${flavorOpt.value}`;
    $sku.textContent = sku;

    sessionStorage.setItem('ttm_step1', JSON.stringify({
      size: sizeCode,
      base: baseOpt.value,
      flavor: flavorOpt.value,
      priceSize: basePrice,
      deltaBase: baseDelta,
      deltaFlavor: flavorDelta,
      priceTotal: total
    }));

    window.dispatchEvent(new CustomEvent('ttm:s1-change', {
      detail: JSON.parse(sessionStorage.getItem('ttm_step1'))
    }));
  }

  [$size,$base,$flavor].forEach(el => el.addEventListener('change', updateSummary));

  // init
  updateMeta();
  updateSummary();

  window.dispatchEvent(new CustomEvent('ttm:s1-change', {
    detail: JSON.parse(sessionStorage.getItem('ttm_step1'))
  }));

  // Responsivo simple para 2 columnas en pantallas medianas
  const grid = document.querySelector('#step1 .grid');
  const mq = window.matchMedia('(max-width: 980px)');
  function resp(){ grid.style.gridTemplateColumns = mq.matches ? '1fr' : '1fr 1fr 1fr'; }
  resp(); mq.addEventListener('change', resp);
})();
</script>

  <script>
/* ====== Paso 2: catálogo, filtros y precio ====== */
(function(){
  // Leer lo seleccionado en paso 1
  let s1 = JSON.parse(sessionStorage.getItem('ttm_step1') || '{}');

  // Mapa de restricciones derivadas del MARCO (base)
  // Flags: v=vegano, s=sugar-free, g=gluten-free
  const RESTR_FOR_BASE = {
    TRD: {v:false, s:false, g:false},
    SAZ: {v:false, s:true,  g:false},
    SGL: {v:false, s:false, g:true },
    INT: {v:false, s:false, g:false},           // integral sin restricción
    ISG: {v:false, s:false, g:true },           // integral sin gluten
    VEG: {v:true,  s:false, g:false},
    VGS: {v:true,  s:false, g:true }            // vegano + sin gluten
  };
  const need = RESTR_FOR_BASE[s1.base] || {v:false,s:false,g:false};

  // Catálogo (puedes editar precios/compatibilidades)
  const FILLS = [
    {code:'MUS', name:'Mousse de chocolate',    price:2500, v:true,  s:false, g:true },
    {code:'DLC', name:'Dulce de leche',         price:1500, v:true,  s:false, g:true },
    {code:'FRU', name:'Frutos rojos',           price:2200, v:true,  s:true,  g:true },
    {code:'CRE', name:'Crema pastelera',        price:1800, v:false, s:false, g:true },
    {code:'LIM', name:'Crema de limón',         price:1800, v:true,  s:true,  g:true },
    {code:'QCH', name:'Cheesecake (capas)',     price:2800, v:false, s:false, g:true },
    {code:'NUT', name:'Praliné de avellanas',   price:2600, v:true,  s:true,  g:true },
    {code:'ZAN', name:'Zanahoria especiada',    price:1900, v:true,  s:true,  g:true },
    {code:'MAN', name:'Manjar sin azúcar',      price:2200, v:true,  s:true,  g:true }
  ];
  const COVERS = [
    {code:'GAN', name:'Ganache chocolate',      price:2500, v:true,  s:false, g:true },
    {code:'BUT', name:'Buttercream clásico',    price:1800, v:false, s:false, g:true },
    {code:'CRM', name:'Crema chantilly',        price:1500, v:false, s:false, g:true },
    {code:'MER', name:'Merengue italiano',      price:1400, v:true,  s:true,  g:true },
    {code:'GLS', name:'Glaseado cítrico',       price:1200, v:true,  s:true,  g:true },
    {code:'VGN', name:'Buttercream vegano',     price:2200, v:true,  s:true,  g:true }
  ];

  const $fill1 = document.getElementById('fill1');
  const $fill2 = document.getElementById('fill2');
  const $cover = document.getElementById('cover');
  const $f1m = document.getElementById('fill1Meta');
  const $f2m = document.getElementById('fill2Meta');
  const $cvm = document.getElementById('coverMeta');
  const $sku = document.getElementById('skuStep2');
  const $price= document.getElementById('priceStep2');

  // Escuchar cambios del Paso 1 en tiempo real
  window.addEventListener('ttm:s1-change', (ev) => {
    const prevBase = s1.base;
    s1 = ev.detail || s1;

    // Si cambió el MARCO/base, hay que volver a renderizar opciones compatibles
    if (s1.base !== prevBase) {
      renderOptions();          // reconstruye fill1/fill2/cover según compatibilidad
    }
      updateSummary();            // recalcula SKU y total con el nuevo priceTotal
  });


  function money(n){ return (n||0).toLocaleString('es-CL',{style:'currency',currency:'CLP',maximumFractionDigits:0}); }

  // Helper: ¿item es compatible con las necesidades del marco?
  function compatible(item){
    if (need.v && !item.v) return false;
    if (need.s && !item.s) return false;
    if (need.g && !item.g) return false;
    return true;
  }

  // Render de selects según compatibilidad
  function renderOptions(){
    // Relleno 1
    $fill1.innerHTML = '';
    FILLS.filter(compatible).forEach(f=>{
      const opt = document.createElement('option');
      opt.value = f.code;
      opt.textContent = `${f.name} (+${money(f.price)})`;
      opt.dataset.price = f.price;
      $fill1.appendChild(opt);
    });

    // Relleno 2 (con opción vacía)
    $fill2.innerHTML = '<option value="">— Sin segundo relleno —</option>';
    FILLS.filter(compatible).forEach(f=>{
      const opt = document.createElement('option');
      opt.value = f.code;
      opt.textContent = `${f.name} (+${money(f.price)})`;
      opt.dataset.price = f.price;
      $fill2.appendChild(opt);
    });

    // Coberturas
    $cover.innerHTML = '';
    COVERS.filter(compatible).forEach(c=>{
      const opt = document.createElement('option');
      opt.value = c.code;
      opt.textContent = `${c.name} (+${money(c.price)})`;
      opt.dataset.price = c.price;
      $cover.appendChild(opt);
    });
  }

  function metaText(code, list){
    const it = list.find(x=>x.code===code);
    return it ? `${it.name} · ${money(it.price)}` : '—';
  }

  function updateSummary(){
    const f1 = $fill1.value;
    const f2 = $fill2.value || '';
    const cv = $cover.value;

    // evitar mismo relleno duplicado (opcional)
    if (f1 && f2 && f1===f2){
      $fill2.value = '';
      return updateSummary();
    }

    $f1m.textContent = metaText(f1, FILLS);
    $f2m.textContent = f2 ? metaText(f2, FILLS) : '—';
    $cvm.textContent = metaText(cv, COVERS);

    const p1 = Number($fill1.selectedOptions[0]?.dataset.price || 0);
    const p2 = Number($fill2.selectedOptions[0]?.dataset.price || 0);
    const pc = Number($cover.selectedOptions[0]?.dataset.price || 0);

    // total acumulado = paso1.priceTotal + sumas de paso2
    const baseTotal = Number(s1?.priceTotal || 0);
    const total = baseTotal + p1 + p2 + pc;
    $price.textContent = money(total);

    // SKU: <paso1 SKU> - <R1><R2>-<COV>
    const sku_s1 = `${s1?.size || 'T??'}-${s1?.base || '???'}-${s1?.flavor || '???'}`;
    const sku_s2 = `${f1 || 'NR'}${f2 || ''}-${cv || 'NC'}`;
    $sku.textContent = `${sku_s1}-${sku_s2}`;

    // Guardar paso 2
    sessionStorage.setItem('ttm_step2', JSON.stringify({
      fill1: f1, fill2: f2, cover: cv,
      priceFill1: p1, priceFill2: p2, priceCover: pc,
      priceTotal: total
    }));
  }

  // Init
  renderOptions();
  [$fill1,$fill2,$cover].forEach(el=>el.addEventListener('change', updateSummary));
  updateSummary();

  // Responsivo: 1–3 columnas
  const grid = document.querySelector('#step2 .grid');
  const mq2  = window.matchMedia('(max-width: 980px)');
  function resp(){ grid.style.gridTemplateColumns = mq2.matches ? '1fr' : '1fr 1fr 1fr'; }
  resp(); mq2.addEventListener('change', resp);
})();
</script>

  
  <script>
    const q = sel => document.querySelector(sel);
    const all = sel => Array.from(document.querySelectorAll(sel));
    const CLP = n => n.toLocaleString('es-CL',{style:'currency',currency:'CLP',maximumFractionDigits:0});

    const tamano = q('#tamano');
    const sabor = q('#sabor');
    const relleno = q('#relleno');
    const relleno2 = q('#relleno2');
    const cobertura = q('#cobertura');
    const diseno = q('#diseno');
    const extras = all('.extra');

    function valPrice(sel){ const opt = sel.options[sel.selectedIndex]; return Number(opt?.dataset.price || 0); }
    function valText(sel){ return sel.options[sel.selectedIndex]?.text || '—'; }
    function valValue(sel){ return sel.value || ''; }
    function tagOf(sel){ const opt = sel.options[sel.selectedIndex]; return opt?.dataset?.tag || ''; }

    function update(){
      let total = 0;
      const summary = [];
      const badges = [];
      const skuParts = ['TT'];

      total += valPrice(tamano);
      summary.push(`Tamaño: ${valText(tamano)}`);
      skuParts.push(valValue(tamano).toUpperCase());

      total += valPrice(sabor);
      summary.push(`Sabor: ${valText(sabor)}`);
      const tagSabor = tagOf(sabor);
      if(tagSabor) badges.push(tagSabor.toUpperCase());

      const r1 = {v:valValue(relleno), lbl:valText(relleno), p:valPrice(relleno), tag:tagOf(relleno)};
      const r2 = {v:valValue(relleno2), lbl:valText(relleno2), p:valPrice(relleno2), tag:tagOf(relleno2)};
      const rellenosTot = r1.p + (r2.v ? r2.p : 0);
      total += rellenosTot;

      summary.push(`Relleno: ${r1.lbl}${r2.v ? ' + ' + r2.lbl : ''}`);
      if(r2.v) badges.push('2 RELLENOS');
      if(r1.tag) badges.push(r1.tag.toUpperCase());
      if(r2.tag) badges.push(r2.tag.toUpperCase());
      if(r2.v) skuParts.push(`R2-${r2.v.toUpperCase()}`);

      total += valPrice(cobertura);
      summary.push(`Cobertura: ${valText(cobertura)}`);
      const tagCob = tagOf(cobertura);
      if(tagCob) badges.push(tagCob.toUpperCase());

      total += valPrice(diseno);
      summary.push(`Diseño: ${valText(diseno)}`);

      const chosenExtras = extras.filter(e=>e.checked).map(e=>({name:e.dataset.name, price:Number(e.dataset.price||0)}));
      chosenExtras.forEach(ex => total += ex.price);
      chosenExtras.forEach(ex => badges.push(ex.name));

      q('#summary').innerHTML = summary.map(s=>`<li>${s}</li>`).join('');
      q('#badges').innerHTML = badges.map(b=>`<span class="pill">${b}</span>`).join('');
      q('#total').textContent = CLP(total);

      const sku = [...skuParts, sabor.value.toUpperCase(), r1.v.toUpperCase()].join('-');
      q('#sku').textContent = `SKU (demo): ${sku}`;
    }

    ['change','input'].forEach(ev => {
      [tamano,sabor,relleno,relleno2,cobertura,diseno].forEach(el => el.addEventListener(ev, update));
      all('.extra').forEach(el => el.addEventListener(ev, update));
    });
    update();

    q('#btnAdd').onclick = ()=>alert('Agregado (demo).');
    q('#btnNext').onclick = ()=>location.href='index.html';

    // Marca enlace activo si quitas el <b>
    document.querySelectorAll('header nav a').forEach(a=>{
      const href = a.getAttribute('href') || '';
      if (location.pathname.endsWith(href)) a.classList.add('active');
    });
  </script>
</body>
</html>




